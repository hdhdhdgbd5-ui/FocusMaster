<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>FocusMaster - The 2 Minute Challenge</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; color: white; overflow-x: hidden; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; text-align: center; }
        header { padding: 20px 0; }
        .logo { font-size: 24px; font-weight: 800; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .tagline { font-size: 14px; color: #94a3b8; margin-top: 5px; }
        .game-area { background: rgba(30, 41, 59, 0.8); border-radius: 24px; padding: 30px; margin: 20px 0; border: 1px solid rgba(148, 163, 184, 0.2); }
        .timer-display { font-size: 72px; font-weight: 800; font-variant-numeric: tabular-nums; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 20px 0; }
        .timer-label { color: #94a3b8; font-size: 14px; margin-top: -10px; }
        .btn { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; border: none; border-radius: 16px; padding: 18px 40px; font-size: 18px; font-weight: 700; cursor: pointer; width: 100%; margin: 10px 0; transition: all 0.1s; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(59, 130, 246, 0.5); }
        .btn:active { transform: translateY(0); }
        .btn-secondary { background: rgba(30, 41, 59, 0.8); border: 2px solid #475569; }
        .btn-secondary:hover { border-color: #60a5fa; }
        .streak-display { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .streak-box { background: rgba(15, 23, 42, 0.6); padding: 15px 25px; border-radius: 16px; min-width: 100px; }
        .streak-value { font-size: 32px; font-weight: 800; color: #fbbf24; }
        .streak-label { font-size: 12px; color: #94a3b8; }
        .leaderboard { background: rgba(30, 41, 59, 0.6); border-radius: 16px; padding: 20px; margin-top: 20px; }
        .leaderboard-title { font-weight: 700; margin-bottom: 15px; color: #60a5fa; }
        .leaderboard-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(148, 163, 184, 0.2); }
        .leaderboard-item:last-child { border-bottom: none; }
        .rank { font-weight: 700; color: #fbbf24; width: 30px; }
        .ad-container { margin: 20px 0; padding: 20px; border-radius: 8px; background: rgba(30, 41, 59, 0.3); min-height: 60px; display: flex; align-items: center; justify-content: center; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: linear-gradient(135deg, #1e293b, #0f172a); border-radius: 24px; padding: 30px; max-width: 400px; width: 100%; border: 1px solid rgba(96, 165, 250, 0.3); }
        .modal-title { font-size: 28px; font-weight: 800; margin-bottom: 10px; }
        .modal-text { color: #94a3b8; margin-bottom: 20px; }
        .hidden { display: none !important; }
        .success { color: #4ade80; }
        .fail { color: #f87171; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .pulse { animation: pulse 1s infinite; }
        .confetti { position: fixed; width: 10px; height: 10px; background: #60a5fa; animation: fall 3s linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .stat-card { background: rgba(15, 23, 42, 0.6); border-radius: 12px; padding: 15px 10px; }
        .stat-value { font-size: 24px; font-weight: 800; color: #60a5fa; }
        .stat-label { font-size: 11px; color: #94a3b8; }
    </style>
    <!-- Google AdSense - Replace with your ID -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-REPLACE-WITH-YOUR-ID"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üéØ FocusMaster</div>
            <div class="tagline">The 2-Minute Focus Challenge</div>
        </header>

        <div class="streak-display">
            <div class="streak-box">
                <div class="streak-value" id="current-streak">0</div>
                <div class="streak-label">üî• Streak</div>
            </div>
            <div class="streak-box">
                <div class="streak-value" style="color: #60a5fa;" id="best-streak">0</div>
                <div class="streak-label">‚≠ê Best</div>
            </div>
            <div class="streak-box">
                <div class="streak-value" style="color: #4ade80;" id="total-sessions">0</div>
                <div class="streak-label">‚úÖ Total</div>
            </div>
        </div>

        <div class="game-area">
            <div class="timer-display" id="timer">02:00</div>
            <div class="timer-label">stay focused. don't touch your phone.</div>
            
            <button class="btn" id="start-btn" onclick="startGame()">üöÄ Start Focus Challenge</button>
            <button class="btn btn-secondary" id="stop-btn" style="display: none;" onclick="stopGame()">‚èπÔ∏è Stop Early</button>
        </div>

        <!-- Ad Banner -->
        <div class="ad-container">
            <div id="ad-banner">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-REPLACE-WITH-YOUR-ID"
                     data-ad-slot="REPLACE-WITH-SLOT-ID"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="coins">0</div>
                <div class="stat-label">üí∞ Coins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="time-focused">0</div>
                <div class="stat-label">‚è±Ô∏è Minutes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="success-rate">0%</div>
                <div class="stat-label">üìà Success</div>
            </div>
        </div>

        <div class="leaderboard">
            <div class="leaderboard-title">üèÜ Today's Leaders</div>
            <div id="leaderboard-list">
                <div class="leaderboard-item">
                    <span><span class="rank">1</span> You</span>
                    <span>0 min</span>
                </div>
            </div>
        </div>

        <button class="btn btn-secondary" onclick="showShop()">üõí Shop (Unlock Themes)</button>

        <div class="ad-container">
            <ins class="adsbygoogle"
                 style="display:block; text-align:center;"
                 data-ad-layout="in-article"
                 data-ad-format="fluid"
                 data-ad-client="ca-pub-REPLACE-WITH-YOUR-ID"
                 data-ad-slot="REPLACE-IN-ARTICLE-SLOT"></ins>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title success">üéâ Focus Complete!</div>
            <div class="modal-text">
                You stayed focused for 2 minutes!<br>
                Streak: <strong id="success-streak">0</strong> days<br>
                Earned: <strong>+10 coins</strong>
            </div>
            <button class="btn" onclick="hideModal('success-modal'); showRewardedAd();">üíé Double Reward (Watch Ad)</button>
            <button class="btn btn-secondary" onclick="hideModal('success-modal')">Claim Reward</button>
        </div>
    </div>

    <!-- Fail Modal -->
    <div id="fail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title fail">üíî Focus Failed</div>
            <div class="modal-text">
                You touched your phone before the timer finished.<br>
                Streak broken: <strong id="fail-streak">0</strong> days<br>
                <br>
                Watch an ad to continue streak?
            </div>
            <button class="btn" onclick="continueStreak(); hideModal('fail-modal');">üíé Continue Streak (Watch Ad)</button>
            <button class="btn btn-secondary" onclick="breakStreak(); hideModal('fail-modal');">Start Over</button>
        </div>
    </div>

    <script>
        let timeLeft = 120; // 2 minutes
        let timerInterval = null;
        let isRunning = false;
        let startTime = null;
        
        let stats = JSON.parse(localStorage.getItem('focusmaster-stats') || JSON.stringify({
            streak: 0,
            bestStreak: 0,
            totalSessions: 0,
            totalMinutes: 0,
            successfulSessions: 0,
            coins: 0,
            lastSession: null
        }));

        // Initialize AdSense
        (adsbygoogle = window.adsbygoogle || []).push({});

        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            checkDayChange();
            
            // Visibility API - detect if tab/app is hidden
            document.addEventListener('visibilitychange', () => {
                if (isRunning && document.hidden) {
                    // User switched tabs - fail
                    stopGame(true);
                }
            });
            
            // Mobile focus/blur
            window.addEventListener('blur', () => {
                if (isRunning) stopGame(true);
            });
            
            // Keep screen on during game
            if (isRunning) {
                navigator.wakeLock?.request('screen');
            }
        });

        function loadStats() {
            document.getElementById('current-streak').textContent = stats.streak;
            document.getElementById('best-streak').textContent = stats.bestStreak;
            document.getElementById('total-sessions').textContent = stats.totalSessions;
            document.getElementById('coins').textContent = stats.coins;
            document.getElementById('time-focused').textContent = stats.totalMinutes;
            
            const rate = stats.totalSessions > 0 
                ? Math.round((stats.successfulSessions / stats.totalSessions) * 100)
                : 0;
            document.getElementById('success-rate').textContent = rate + '%';
        }

        function checkDayChange() {
            const today = new Date().toDateString();
            const lastDate = stats.lastSession ? new Date(stats.lastSession).toDateString() : null;
            
            if (lastDate && lastDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (new Date(stats.lastSession).toDateString() !== yesterday.toDateString()) {
                    // Missed a day - streak breaks
                    if (stats.streak > 0) {
                        stats.streak = 0;
                        saveStats();
                    }
                }
            }
        }

        function startGame() {
            if (isRunning) return;
            
            isRunning = true;
            timeLeft = 120;
            startTime = Date.now();
            
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'block';
            document.getElementById('timer').classList.add('pulse');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    completeGame();
                }
            }, 1000);
        }

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopGame(failed = false) {
            if (!isRunning) return;
            
            clearInterval(timerInterval);
            isRunning = false;
            
            document.getElementById('timer').classList.remove('pulse');
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('stop-btn').style.display = 'none';
            
            if (failed) {
                failGame();
            }
        }

        function completeGame() {
            stopGame();
            
            // Update stats
            stats.streak++;
            stats.bestStreak = Math.max(stats.bestStreak, stats.streak);
            stats.totalSessions++;
            stats.successfulSessions++;
            stats.totalMinutes += 2;
            stats.coins += 10;
            stats.lastSession = new Date().toISOString();
            
            saveStats();
            loadStats();
            createConfetti();
            
            // Show success modal
            document.getElementById('success-streak').textContent = stats.streak;
            showModal('success-modal');
        }

        function failGame() {
            stats.totalSessions++;
            document.getElementById('fail-streak').textContent = stats.streak;
            saveStats();
            loadStats();
            showModal('fail-modal');
        }

        function continueStreak() {
            // Watch rewarded ad, save streak
            // In real implementation, this triggers ad
            stats.lastSession = new Date().toISOString();
            saveStats();
        }

        function breakStreak() {
            stats.streak = 0;
            saveStats();
            loadStats();
        }

        function saveStats() {
            localStorage.setItem('focusmaster-stats', JSON.stringify(stats));
        }

        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function hideModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        function showRewardedAd() {
            // Trigger rewarded ad
            // After ad: double coins
            stats.coins += 10;
            saveStats();
            loadStats();
            showNotification('+20 coins total!');
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = ['#60a5fa', '#a78bfa', '#4ade80', '#fbbf24'][Math.floor(Math.random() * 4)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showNotification(message) {
            const note = document.createElement('div');
            note.style.cssText = 'position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; padding: 12px 24px; border-radius: 25px; font-weight: 600; z-index: 1000;';
            note.textContent = message;
            document.body.appendChild(note);
            setTimeout(() => note.remove(), 3000);
        }

        function showShop() {
            alert('Shop coming soon! Spend coins to unlock themes\n\nCurrent coins: ' + stats.coins);
        }

        // Initial load
        loadStats();
        
        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
    </script>
</body>
</html>